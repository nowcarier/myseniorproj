{% extends "layouts/base.html" %}

{% block title %} UI Tables {% endblock %}

<!-- Specific CSS goes HERE -->
{% block stylesheets %}
<!--Font Awesome (added because you use icons in your prepend/append)-->
<!-- Inline CSS based on choices in "Settings" tab -->
<link href='/static/assets/css/main.css' rel='stylesheet' />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/10.15.5/sweetalert2.css"
    integrity="sha512-WfDqlW1EF2lMNxzzSID+Tp1TTEHeZ2DK+IHFzbbCHqLJGf2RyIjNFgQCRNuIa8tzHka19sUJYBO+qyvX8YBYEg=="
    crossorigin="anonymous" />
<style>
    body {
        margin-top: 40px;
        font-size: 14px;
        font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
    }

    #external-events {
        position: fixed;
        left: 20%;
        top: 20px;
        width: 150px;
        padding: 0 10px;
        border: 1px solid #ccc;
        background: #eee;
        text-align: left;
    }

    #external-events h4 {
        font-size: 16px;
        margin-top: 0;
        padding-top: 1em;
    }

    #external-events .fc-event {
        margin: 3px 0;
        cursor: move;
    }

    #external-events p {
        margin: 1.5em 0;
        font-size: 11px;
        color: #666;
    }

    #external-events p input {
        margin: 0;
        vertical-align: middle;
    }

    #calendar-wrap {
        margin-left: 200px;
    }

    #calendar {
        max-width: 1100px;
        margin: 0 auto;
    }
</style>

{% endblock stylesheets %}

{% block content %}

<div class="pcoded-content">
    <div class="pcoded-inner-content">
        <!-- [ breadcrumb ] start -->
        <div class="page-header">
            <div class="page-block">
                <div class="row align-items-center">
                    <div class="col-md-12">
                        <div class="page-header-title">
                            <h5 class="m-b-10">Bootstrap Basic Tables</h5>
                        </div>
                        <ul class="breadcrumb">
                            <li class="breadcrumb-item"><a href="index.html"><i class="feather icon-home"></i></a></li>
                            <li class="breadcrumb-item"><a href="#!">Tables</a></li>
                            <li class="breadcrumb-item"><a href="javascript:">Basic Tables</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <!-- [ breadcrumb ] end -->
        <div class="main-body">
            <div class="page-wrapper">
                <!-- [ Main Content ] start -->
                <div class="row">
                    <!-- [ Hover-table ] start -->
                    <!-- <div class="col-xl-12">
                        <div class="card">
                            <div class="card-header">
                                <h5>Staff</h5>
                                <span class="d-block m-t-5">use class <code>table-hover</code> inside table
                                    element</span>
                            </div>
                            <div class="card-block table-border-style">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>id</th>
                                                <th>First Name</th>
                                                <th>Last Name</th>
                                                <th>Username</th>
                                                <th>Staff</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for i in users%}
                                            {% if i.is_staff == True %}
                                            <tr>
                                                <th scope="row">{{i.id}}</th>
                                                <td>{{i.first_name}}</td>
                                                <td>{{i.last_name}}</td>
                                                <td>{{i.username}}</td>
                                                <td>{{i.is_staff}}</td>
                                            </tr>
                                            {% endif %}
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div> -->
                    <!-- [ Hover-table ] end -->
                </div>
                <!-- [ Main Content ] end -->
            </div>
        </div>
    </div>
</div>
<div class="pcoded-content">
    <div class="pcoded-inner-content">

        <div class="main-body">
            <div class="page-wrapper">
                <!-- [ Main Content ] start -->
                <div class="row">
                    <!-- [ Hover-table ] start -->
                    <div class="col-xl-12">
                        <div class="card">
                            <div class="card-header">
                                <h5>Staff</h5>
                                <span class="d-block m-t-5">use class <code>table-hover</code> inside table
                                    element</span>
                            </div>
                            <div class="card-block table-border-style">
                                <div class="table-responsive">
                                    <div id='wrap'>

                                        <div id='external-events'>
                                            <h4>Staff List</h4>

                                            <div id='external-events-list'>
                                                {% for i in users%}
                                                {% if i.is_staff == True %}
                                                <div
                                                    class='fc-event fc-h-event fc-daygrid-event fc-daygrid-block-event'>
                                                    <div class='fc-event-main' id='uid'>{{i.id}} {{i.username}}</div>
                                                </div>
                                                {% endif %}
                                                {% endfor %}
                                            </div>
                                            <p>
                                                <input type='checkbox' id='drop-remove' />
                                                <label for='drop-remove'>remove after drop</label>
                                                <button type="submit" onclick="PutEvent();">OK</button>
                                            </p>
                                        </div>

                                        <div id='calendar-wrap'>
                                            <div id='calendar'></div>
                                            <div id='new'>
                                                {% for j in date %}
                                                <h3 type="hidden" id="getDate" class="{{ j }}"></h3>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- [ Hover-table ] end -->
                </div>
                <!-- [ Main Content ] end -->
            </div>
        </div>
    </div>
</div>

{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}
<script>
    $('#external-events').hide();
    $(document).scroll(function () {
        var y = $(this).scrollTop();
        if (y > 100) {
            $('#external-events').fadeIn();
        } else {
            $('#external-events').fadeOut();
        }
    });
    var listEvent = [];

    document.addEventListener('DOMContentLoaded', function () {

        /* initialize the external events
        -----------------------------------------------------------------*/

        var containerEl = document.getElementById('external-events-list');
        new FullCalendar.Draggable(containerEl, {
            itemSelector: '.fc-event',
            eventData: function (eventEl) {
                return {
                    title: eventEl.innerText.trim()
                }
            }
        });

        var calendarEl = document.getElementById('calendar');
        var getDate = document.querySelectorAll('[id=getDate]');
        var allDate = []
        for (i in getDate) {
            if (getDate[i].className != undefined) {
                allDate.push(getDate[i].className)
            }
        }
        var events = []; //The array
        for (var i = 0; i < allDate.length; i++) { events.push({ title: 'test user', start: allDate[i] }) }
        console.log(events)

        var calendar = new FullCalendar.Calendar(calendarEl, {
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'
            },
            events: events,
            editable: true,
            droppable: true, // this allows things to be dropped onto the calendar
            drop: function (arg) {
                // data = arg.draggedEl.outerText + ":" + arg.dateStr;
                id = arg.draggedEl.outerText
                id = id.split(" ");
                id = parseInt(id[0]);
                // console.log(id);
                listEvent.push({ key: id, value: arg.dateStr });
                // var a = []
                // for (var key in listEvent) {
                //     if (a.includes(listEvent[key].key) == true) {
                //         alert(listEvent[key].key, 'key exited');
                //     } if (a.includes(listEvent[key].key) == false) {
                //         a.push(listEvent[key].key);
                //     }
                //     // console.log(b);
                // }
                // console.log(listEvent)


                // is the "remove after drop" checkbox checked?
                if (document.getElementById('drop-remove').checked) {
                    // if so, remove the element from the "Draggable Events" list
                    arg.draggedEl.parentNode.removeChild(arg.draggedEl);
                }
            }
        });
        calendar.render();

    });

    function PutEvent() {
        Swal.fire({
            title: 'Are you sure?',
            text: "You won't be able to revert this!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, save it!'
        }).then((result) => {
            if (result.isConfirmed) {
                allEvent = []
                allEvent.push({ "data": listEvent })
                console.log(listEvent)
                $.ajax({
                    type: "POST",
                    url: 'http://192.168.43.85/PutEvent',
                    data: allEvent[0],
                    success: "success"
                });
                Swal.fire(
                    'Success!',
                    'Save successfully.',
                    'success'
                )
            }
        })
    };

</script>
{% endblock javascripts %}