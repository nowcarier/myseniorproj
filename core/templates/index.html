{% extends "layouts/base.html" %}

{% block title %} Dashboard {% endblock %} 

<!-- Specific CSS goes HERE -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}

    <div class="pcoded-content">
        <div class="pcoded-inner-content">
            <!-- [ breadcrumb ] start -->

            <!-- [ breadcrumb ] end -->
            <div class="main-body">
                <div class="page-wrapper">
                    <!-- [ Main Content ] start -->
                    <div class="row" id="allstatus">
                        <!--[ daily sales section ] start-->
                        <div class="col-md-6 col-xl-4">
                            <div class="card daily-sales shadow-lg p-3 mb-5 bg-white rounded">
                                <div class="card-block">
                                    <h3 class="mb-4 text-c-green">Light Status</h3>
                                    <div class="row d-flex align-items-center">
                                        <div class="col-9">
                                            <h3 class="f-w-300 d-flex align-items-center m-b-0"><i class="feather text-c-green f-30 m-r-10"></i>
                                            {% for i in device|slice:":1" %}
                                                <h3>{{i.light_status}}</h3>
                                            {% endfor %}
                                            </h3>
                                        </div>
                                        <div class="col-3 text-right">
                                            <img class="rounded-circle" style="width:40px;" src="/static/assets/images/user/light.png" alt="activity-user">
                                        </div>
                                    </div>
                                    <div class="progress m-t-30" style="height: 7px;">
                                        <div class="progress-bar progress-c-theme" role="progressbar" style="width: 50%;" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--[ daily sales section ] end-->
                        <!--[ Monthly  sales section ] starts-->
                        <div class="col-md-6 col-xl-4">
                            <div class="card Monthly-sales shadow-lg p-3 mb-5 bg-white rounded">
                                <div class="card-block">
                                    <h3 class="mb-4 text-c-blue">Air Status</h3>
                                    <div class="row d-flex align-items-center">
                                        <div class="col-9">
                                            <h3 class="f-w-300 d-flex align-items-center  m-b-0"><i class="feather text-c-red f-30 m-r-10"></i>
                                            {% for i in device|slice:":1" %}
                                                <h3>{{i.air_conditioner_status}}</h3>
                                            {% endfor %}</h3>
                                        </div>
                                        <div class="col-3 text-right">
                                            <img class="rounded-circle" style="width:40px;" src="/static/assets/images/user/air1.png" alt="activity-user">
                                        </div>
                                    </div>
                                    <div class="progress m-t-30" style="height: 7px;">
                                        <div class="progress-bar progress-c-theme2" role="progressbar" style="width: 35%;" aria-valuenow="35" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--[ Monthly  sales section ] end-->
                        <!--[ year  sales section ] starts-->
                        <div class="col-md-12 col-xl-4" >
                            <div class="card yearly-sales shadow-lg p-3 mb-5 bg-white rounded">
                                <div class="card-block">
                                    <h3 class="mb-4 text-c-yellow">Projector Status</h3>
                                    <div class="row d-flex align-items-center">
                                        <div class="col-9">
                                            <h3 class="f-w-300 d-flex align-items-center  m-b-0"><i class="feather text-c-green f-30 m-r-10"></i>
                                            {% for i in device|slice:":1" %}
                                                <h3>{{i.projector_status}}</h3>
                                            {% endfor %}</h3></h3>
                                        </div>
                                        <div class="col-3 text-right">
                                            <img class="rounded-circle" style="width:40px;" src="/static/assets/images/user/projector.png" alt="activity-user">
                                        </div>
                                    </div>
                                    <div class="progress m-t-30" style="height: 7px;">
                                        <div class="progress-bar progress-c-theme" role="progressbar" style="width: 70%;" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--[ year  sales section ] end-->
                        <!--[ Recent Users ] start-->
                        <div class="col-xl-8 col-md-6" id = "RequestUsers" >
                            <div class="card Recent-Users" id = "RequestUsers">
                                <div class="card-header">
                                    <h5>Recent Users</h5>
                                </div>
                                <div class="card-block px-0 py-3">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <tbody>
                                                {% for i in users%}
                                                    {% if i.is_active == False %}
                                                    <tr class="unread">
                                                    <td><img class="rounded-circle" style="width:40px;" src="/static/assets/images/user/avatar-1.jpg" alt="activity-user"></td>
                                                    <td>
                                                        <h6 class="mb-1">{{i.id}}</h6>
                                                    </td>
                                                    <td>
                                                        <h6 class="mb-1">{{i.username}}</h6>
                                                    </td>
                                                    <td>
                                                        <h6 class="text-muted"><i class="fas f-10 m-r-15"></i>{{i.date_joined}}</h6>
                                                    </td>
                                                    <td>
                                                        <h6 class="text-muted"><i class="fas fa-circle text-c-red f-10 m-r-15"></i>{{i.is_active}}</h6>
                                                    </td>
                                                    <td>
                                                    <form>
                                                        <input type="hidden" id="username" value={{ i.username }} />
                                                        <input type="hidden" id="password" value={{ i.password }} />
                                                        <input type="hidden" id="id" value={{ i.id }} />
                                                        <input type="hidden" id="is_active" value="1" />
                                                        <input type="hidden" id="is_staff" value="1" />
                                                        <a href="#" value="1" id="submitButton" class="label theme-bg text-white f-12" onclick='approve("{{ i.id }}", "{{ i.username }}", "{{ i.password }}")'>Approve</a>
                                                        <a href="#" value="1" id="submitButton" class="label theme-bg text-white f-12" onclick='approveToStaff("{{ i.id }}", "{{ i.username }}", "{{ i.password }}")'>Staff</a>
                                                        <a href="#" id="rejectButton" class="label theme-bg2 text-white f-12" onclick='reject("{{ i.id }}")'>Reject</a>
                                                    </form>
                                                    </td>
                                                    </tr>
                                                    {% endif %}
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--[ Recent Users ] end-->

                        <!-- [ statistics year chart ] start -->
                        <div class="col-xl-4 col-md-6">
                        <div class="card">
                                <div class="card-block border-bottom">
                                    <div class="row d-flex align-items-center">
                                        <div class="col-auto">
                                            <i class="feather icon-user-plus f-30 text-c-green"></i>
                                        </div>
                                        <div class="col">
                                            <h3 class="f-w-300">{{ countUserRequest }}</h3>
                                            <span class="d-block text-uppercase">TOTAL Users Request</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-block">
                                    <div class="row d-flex align-items-center">
                                        <div class="col-auto">
                                            <i class="feather icon-users f-30 text-c-blue"></i>
                                        </div>
                                        <div class="col">
                                            <h3 class="f-w-300">{{countUser}}</h3>
                                            <span class="d-block text-uppercase">TOTAL All Users</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- [ statistics year chart ] end -->
                        <!-- [ rating list ] end-->
                        <div class="col-xl-8 col-md-12 m-b-30">
                            <ul class="nav nav-tabs" id="myTab" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="false">Today</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link active show" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="true">This Week</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="contact-tab" data-toggle="tab" href="#contact" role="tab" aria-controls="contact" aria-selected="false">All</a>
                                </li>
                            </ul>
                            <div class="tab-content" id="myTabContent">
                                <div class="tab-pane fade" id="home" role="tabpanel" aria-labelledby="home-tab">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>User</th>
                                                <th>Activity</th>
                                                <th>Time</th>
                                                <th>Status</th>
                                                <th class="text-right"></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <h6 class="m-0"><img class="rounded-circle m-r-10" style="width:40px;" src="/static/assets/images/user/avatar-1.jpg" alt="activity-user">Ida Jorgensen</h6>
                                                </td>
                                                <td>
                                                    <h6 class="m-0">The quick brown fox</h6>
                                                </td>
                                                <td>
                                                    <h6 class="m-0">3:28 PM</h6>
                                                </td>
                                                <td>
                                                    <h6 class="m-0 text-c-green">Done</h6>
                                                </td>
                                                <td class="text-right"><i class="fas fa-circle text-c-green f-10"></i></td>
                                            </tr>
                                            
                                            <tr>
                                                <td>
                                                    <h6 class="m-0"><img class="rounded-circle  m-r-10" style="width:40px;" src="/static/assets/images/user/avatar-2.jpg" alt="activity-user">Albert Andersen</h6>
                                                </td>
                                                <td>
                                                    <h6 class="m-0">Jumps over the lazy</h6>
                                                </td>
                                                <td>
                                                    <h6 class="m-0">2:37 PM</h6>
                                                </td>
                                                <td>
                                                    <h6 class="m-0 text-c-red">Missed</h6>
                                                </td>
                                                <td class="text-right"><i class="fas fa-circle text-c-red f-10"></i></td>
                                            </tr>

                                            <tr>
                                                <td>
                                                    <h6 class="m-0"><img class="rounded-circle  m-r-10" style="width:40px;" src="/static/assets/images/user/avatar-3.jpg" alt="activity-user">Silje Larsen</h6>
                                                </td>
                                                <td>
                                                    <h6 class="m-0">Dog the quick brown</h6>
                                                </td>
                                                <td>
                                                    <h6 class="m-0">10:23 AM</h6>
                                                </td>
                                                <td>
                                                    <h6 class="m-0 text-c-purple">Delayed</h6>
                                                </td>
                                                <td class="text-right"><i class="fas fa-circle text-c-purple f-10"></i></td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <h6 class="m-0"><img class="rounded-circle  m-r-10" style="width:40px;" src="/static/assets/images/user/avatar-1.jpg" alt="activity-user">Ida Jorgensen</h6>
                                                </td>
                                                <td>
                                                    <h6 class="m-0">The quick brown fox</h6>
                                                </td>
                                                <td>
                                                    <h6 class="m-0">4:28 PM</h6>
                                                </td>
                                                <td>
                                                    <h6 class="m-0 text-c-green">Done</h6>
                                                </td>
                                                <td class="text-right"><i class="fas fa-circle text-c-green f-10"></i></td>
                                            </tr>
                                        </tbody>
                                    </table>

                                </div>
                                <div class="tab-pane fade active show" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>User</th>
                                                <th>Active</th>
                                                <th>Date joined</th>
                                                <th>Email</th>
                                                <th class="text-right"></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for i in users%}
                                                {% comment %} <h3>{{i.datetime}}</h3> {% endcomment %}
                                                <tr>
                                                <td>
                                                    <h6 class="m-0"><img class="rounded-circle  m-r-10" style="width:40px;" src="/static/assets/images/user/avatar-2.jpg" alt="activity-user">{{i.first_name}} {{i.last_name}}</h6>
                                                </td>
                                                <td>
                                                    <h6 class="m-0">{{i.is_active}}</h6>
                                                </td>
                                                <td>
                                                    <h6 class="m-0">{{i.date_joined}}</h6>
                                                </td>
                                                <td>
                                                    <h6 class="m-0 text-c-red">{{i.email}}</h6>
                                                </td>
                                                <td class="text-right"><i class="fas fa-circle text-c-red f-10"></i></td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>

                                </div>
                                <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>User</th>
                                                <th>Activity</th>
                                                <th>Time</th>
                                                <th>Status</th>
                                                <th class="text-right"></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <h6 class="m-0"><img class="rounded-circle  m-r-10" style="width:40px;" src="/static/assets/images/user/avatar-3.jpg" alt="activity-user">Silje Larsen</h6>
                                                </td>
                                                <td>
                                                    <h6 class="m-0">Dog the quick brown</h6>
                                                </td>
                                                <td>
                                                    <h6 class="m-0">10:23 AM</h6>
                                                </td>
                                                <td>
                                                    <h6 class="m-0 text-c-purple">Delayed</h6>
                                                </td>
                                                <td class="text-right"><i class="fas fa-circle text-c-purple f-10"></i></td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <h6 class="m-0"><img class="rounded-circle m-r-10" style="width:40px;" src="/static/assets/images/user/avatar-1.jpg" alt="activity-user">Ida Jorgensen</h6>
                                                </td>
                                                <td>
                                                    <h6 class="m-0">The quick brown fox</h6>
                                                </td>
                                                <td>
                                                    <h6 class="m-0">3:28 PM</h6>
                                                </td>
                                                <td>
                                                    <h6 class="m-0 text-c-green">Done</h6>
                                                </td>
                                                <td class="text-right"><i class="fas fa-circle text-c-green f-10"></i></td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <h6 class="m-0"><img class="rounded-circle  m-r-10" style="width:40px;" src="/static/assets/images/user/avatar-2.jpg" alt="activity-user">Albert Andersen</h6>
                                                </td>
                                                <td>
                                                    <h6 class="m-0">Jumps over the lazy</h6>
                                                </td>
                                                <td>
                                                    <h6 class="m-0">2:37 PM</h6>
                                                </td>
                                                <td>
                                                    <h6 class="m-0 text-c-red">Missed</h6>
                                                </td>
                                                <td class="text-right"><i class="fas fa-circle text-c-red f-10"></i></td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <h6 class="m-0"><img class="rounded-circle  m-r-10" style="width:40px;" src="/static/assets/images/user/avatar-1.jpg" alt="activity-user">Ida Jorgensen</h6>
                                                </td>
                                                <td>
                                                    <h6 class="m-0">The quick brown fox</h6>
                                                </td>
                                                <td>
                                                    <h6 class="m-0">4:28 PM</h6>
                                                </td>
                                                <td>
                                                    <h6 class="m-0 text-c-green">Done</h6>
                                                </td>
                                                <td class="text-right"><i class="fas fa-circle text-c-green f-10"></i></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                    </div>
                    <!-- [ Main Content ] end -->
                </div>
            </div>
        </div>
    </div>

{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}

<script>
setInterval(function(){
   $.get('http://192.168.43.85/',
        {
            action:'index',
            var:'value'
        },
        function(data,status){
            if(status=='success') {
                $("#allstatus").load(" #allstatus");
            }
        });
}, 30000) /* time in milliseconds (ie 2 seconds)*/

function approve(id, username, password){
    var url = "http://192.168.43.85/get/approve/"+ id;
    const xhr = new XMLHttpRequest();
    xhr.open("PATCH", url);

    xhr.setRequestHeader("Authorization", "TOKEN 43e712041c005264f022ce6e6c08bbb0d79f8e3f");
    xhr.setRequestHeader("Content-Type", "application/json");

    xhr.onreadystatechange = function () {
    if (xhr.readyState === 4) {
        console.log(xhr.status);
        console.log(xhr.responseText);
    }};
    
    var data = {};
    data.username = username;
    data.password = password;
    data.is_active = 1;
    datas = data;
    xhr.send(JSON.stringify(data));


    $.get('http://192.168.43.85/',
        {
            action:'index',
            var:'value'
        },
        function(data,status){
            if(status=='success') {
                $("#RequestUsers").load(" #RequestUsers");
            }
        });
}

function approveToStaff(id, username, password){
    var url = "http://192.168.43.85/get/approve/"+ id;
    const xhr = new XMLHttpRequest();
    xhr.open("PATCH", url);

    xhr.setRequestHeader("Authorization", "TOKEN 43e712041c005264f022ce6e6c08bbb0d79f8e3f");
    xhr.setRequestHeader("Content-Type", "application/json");

    xhr.onreadystatechange = function () {
    if (xhr.readyState === 4) {
        console.log(xhr.status);
        console.log(xhr.responseText);
    }};
    
    var data = {};
    data.username = username;
    data.password = password;
    data.is_active = 1;
    data.is_staff = 1;
    datas = data;
    xhr.send(JSON.stringify(data));


    $.get('http://192.168.43.85/',
        {
            action:'index',
            var:'value'
        },
        function(data,status){
            if(status=='success') {
                $("#RequestUsers").load(" #RequestUsers");
            }
        });
}


function reject(id) {
    // alert(id)
    var url = "http://192.168.43.85/get/approve/"+ id;
    const xhr = new XMLHttpRequest();
    xhr.open("DELETE", url);

    xhr.setRequestHeader("Authorization", "TOKEN 43e712041c005264f022ce6e6c08bbb0d79f8e3f");
    xhr.setRequestHeader("Content-Type", "application/json");

    xhr.onreadystatechange = function () {
    if (xhr.readyState === 4) {
        console.log(xhr.status);
        console.log(xhr.responseText);
    }};
    
    var data = {};
    data.username = username;
    data.password = password;
    data.is_active = is_active;
    datas = data;
    xhr.send(JSON.stringify(data));

    $.get('http://192.168.43.85/',
        {
            action:'index',
            var:'value'
        },
        function(data,status){
            if(status=='success') {
                $("#RequestUsers").load(" #RequestUsers");
            }
        });
};



</script>

{% endblock javascripts %}
